<p align="center">
   <picture>
     <source media="(prefers-color-scheme: dark)" srcset="https://github.com/Qcraft-UEx/Qcraft/blob/main/docs/_images/qcraft_logo.png?raw=true" width="60%">
     <img src="https://github.com/Qcraft-UEx/Qcraft/blob/main/docs/_images/qcraft_logo.png?raw=true" width="60%" alt="Qcraft Logo">
   </picture>
  </a>
</p>

# QCRAFT-Multi-Batch Circuit Scheduling
QCRAFT Multi-Batch Circuit Scheduling: a library that enables efficient quantum hardware utilization through horizontal multi-programming, allowing multiple circuit batches to be executed sequentially within a single job, dramatically reducing cost and queue time.

The scheduler has the following main functions:

1. **Circuit Reception:** Users submit their quantum circuits to the scheduler for execution. Each user specifies the number of shots required and sends the circuit via the URL generated by a quantum circuit simulator such as Quirk or via Python code, such as IBM's Qiskit language.

2. **Queuing:** Submitted circuits are added to a queue, and each user receives a unique identifier for execution. Circuits are scheduled for execution in cycles, where the scheduler waits for the available qubits to fill before scheduling the circuits.

3. **Quantum Policies:** During scheduling, the scheduler combines circuits based on the availability of qubits in the quantum machine. It uses three different scheduling policies, which can be selected by the user.

4. **Combined Circuit Execution:** Once the circuits have been combined, the scheduler schedules the execution of the combined circuit in the quantum machine. The results of this execution are a combination of the results of each individual circuit.

5. **Unscheduling of the results:** These results go through a unscheduling process to divide the results by user, and are stored in a database.

![Python Versions](https://img.shields.io/badge/python-3.9%20|%203.10%20|%203.11%20|%203.12-blue.svg)
[![License](https://img.shields.io/badge/license-MIT-green.svg)](https://github.com/Qcraft-UEx/QCRAFT/blob/main/LICENSE)

## Installation

You can install all the Scheduler dependencies using pip:

```bash
pip install -r requirements.txt
```

## Usage

To initialize the Scheduler you need ports 8081 and 8082 free. The translator uses the port 8081 and the Scheduler the port 8082. If you need to change the ports, refer to the [Configuration](#configuration) section.
Also, it is mandatory to have both AWS and IBM Quantum accounts saved to run the circuits on the cloud.

At first, you need to initialize the mongoDB database.
```bash
cd db
sudo docker compose up --build
```

After initializing the database, you need to start both the translator and the Scheduler on two different terminals because they are both Flask APIs.

```bash
python3 translator.py
```

```bash
python3 scheduler.py
```

Here is a basic example on how to send a Quirk URL to the Scheduler. The Quirk URL will only be accepted in the /url path. You must specify shots and the policy that is used is the multibatch.
```python
import requests

data = {"url":"https://algassert.com/quirk#circuit={'cols':[['H'],['â€¢','X'],['Measure','Measure']]}" ,"shots":1000, "provider":"ibm", "policy":"multibatch"} 
requests.post(localhost:8082/url, json = data)
```

circuit_id = response.text.split("Your id is ")[1]

params = {'id': circuit_id}

response = requests.get(localhost:8082/result,params=params).text
results = json.loads(response)
```

## Configuration

The application can be configured by modifying the `.env` file located at the `/db` folder. This file allows you to change the hostname, port, and other configuration elements crucial for the application's operation.

### Setting up the `.env` file
Open the `.env` file and modify the settings according to your environment and preferences.

### Example `.env` content

```plaintext
# Host configuration
HOST=localhost
PORT=8082

# Translator configuration
TRANSLATOR=localhost
TRANSLATOR_PORT=8081

# Database configuration
DB=localhost
DB_PORT=5432
DB_NAME=name
DB_COLLECTION=collection
DB_USER=username
DB_PASSWORD=password
```


## License
QCRAFT Scheduler is licensed under the [MIT License](https://github.com/Qcraft-UEx/QCRAFT/blob/main/LICENSE)

